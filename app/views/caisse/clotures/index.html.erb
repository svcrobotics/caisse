<div class="max-w-5xl mx-auto bg-white shadow rounded p-6 mt-8">

  <h1 class="text-3xl font-bold text-gray-800 mb-6">🧾 Clôtures de caisse</h1>

  <!-- 📅 Clôture journalière -->
  <div class="bg-yellow-50 border border-yellow-300 p-4 rounded mb-8">
    <p class="text-yellow-800 font-semibold text-sm mb-4">📆 Clôture journalière</p>

    <div class="bg-gray-100 border px-4 py-2 rounded mb-4 text-sm">
      💡 <strong>Il devrait théoriquement y avoir en caisse</strong> : <%= number_to_currency(@fond_caisse_theorique) %>
      <br>
      <%= link_to "💶 Voir le détail des espèces", main_app.especes_path, class: "inline-block mt-2 text-blue-600 hover:underline" %>
    </div>

    <%= form_with url: cloture_z_clotures_path, method: :post, local: true do %>
      <div class="flex flex-col md:flex-row md:items-end md:space-x-4 space-y-3 md:space-y-0">

        <!-- Date -->
        <div>
          <%= label_tag :date, "Date de la clôture (AAAA-MM-JJ)", class: "block text-sm font-medium text-gray-700" %>
          <%= text_field_tag :date, Date.current.to_s, class: "mt-1 block w-40 border-gray-300 rounded shadow-sm px-3 py-2" %>
        </div>

        <!-- Fond de caisse final -->
        <div>
          <%= label_tag :fond_caisse_final, "💶 Fond de caisse final (compté)", class: "block text-sm font-medium text-gray-700" %>
          <%= number_field_tag :fond_caisse_final, nil, step: 0.01, required: true,
            class: "mt-1 block w-40 border-gray-300 rounded shadow-sm px-3 py-2" %>
        </div>

        <!-- Bouton -->
        <div>
          <%= submit_tag "🧾 Clôturer la journée",
                class: "bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded font-semibold" %>
        </div>

      </div>
    <% end %>
  </div>

  <br>

  <!-- 📆 Clôture mensuelle -->
  <div class="bg-yellow-50 border border-yellow-300 p-4 rounded mb-8">
    <p class="text-yellow-800 font-semibold text-sm mb-2">📆 Clôture mensuelle</p>

    <%= form_with url: cloture_mensuelle_clotures_path, method: :post, local: true do %>
      <div class="flex flex-col md:flex-row md:items-end md:space-x-4 space-y-3 md:space-y-0">
        <div>
          <%= label_tag :mois, "Mois à clôturer (format AAAA-MM)", class: "block text-sm font-medium text-gray-700" %>
          <%= text_field_tag :mois, Date.today.strftime("%Y-%m"), class: "mt-1 block w-40 border-gray-300 rounded shadow-sm px-3 py-2" %>
        </div>
        <div>
          <%= submit_tag "Clôturer le mois", class: "bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded font-semibold" %>
        </div>
      </div>
    <% end %>
  </div>
  <br>
  <!-- 📊 Liste des clôtures -->
  <h2 class="text-xl font-semibold text-gray-700 mb-4">Historique des clôtures</h2>

  <div class="overflow-x-auto">
    <table class="min-w-full bg-white border border-gray-300 rounded shadow-sm">
      <thead class="bg-gray-100">
        <tr>
          <th class="text-left px-4 py-2 border-b">📅 Date</th>
          <th class="text-left px-4 py-2 border-b">Catégorie</th>
          <th class="text-right px-4 py-2 border-b">Total TTC</th>
          <th class="text-center px-4 py-2 border-b">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @clotures.each do |cloture| %>
          <tr class="hover:bg-gray-50 border-b">
            <td class="px-4 py-2"><%= l cloture.date %></td>
            <td class="px-4 py-2 capitalize"><%= cloture.categorie %></td>
            <td class="px-4 py-2 text-right font-mono"><%= number_to_currency(cloture.total_ttc) %></td>
            <td class="px-4 py-2 text-center space-x-2">
              <%= link_to "👁️ Voir", cloture_path(cloture),
                  class: "inline-block bg-gray-100 hover:bg-gray-200 text-gray-800 px-3 py-1 rounded text-sm font-medium" %>
              <%= link_to "🖨️ Imprimer", imprimer_cloture_path(cloture),
                  method: :get,
                  class: "inline-block bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm font-medium" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
